name: Check FTP Configuration

on:
  workflow_dispatch:

jobs:
  check-ftp:
    name: Verificar Configura√ß√£o FTP
    runs-on: ubuntu-latest
    
    steps:
    - name: Check FTP Secrets Configuration
      run: |
        echo "üîê Verificando configura√ß√£o dos secrets FTP..."
        echo "============================================="
        echo ""
        
        # Verificar cada secret
        if [ -z "${{ secrets.FTP_SERVER }}" ]; then
          echo "‚ùå FTP_SERVER n√£o configurado"
        else
          echo "‚úÖ FTP_SERVER configurado: ${{ secrets.FTP_SERVER }}"
        fi
        
        if [ -z "${{ secrets.FTP_USERNAME }}" ]; then
          echo "‚ùå FTP_USERNAME n√£o configurado"
        else
          echo "‚úÖ FTP_USERNAME configurado: ${{ secrets.FTP_USERNAME }}"
        fi
        
        if [ -z "${{ secrets.FTP_PASSWORD }}" ]; then
          echo "‚ùå FTP_PASSWORD n√£o configurado"
        else
          echo "‚úÖ FTP_PASSWORD configurado: [OCULTO]"
        fi
        
        if [ -z "${{ secrets.FTP_REMOTE_DIR }}" ]; then
          echo "‚ö†Ô∏è FTP_REMOTE_DIR n√£o configurado (usar√° / como padr√£o)"
        else
          echo "‚úÖ FTP_REMOTE_DIR configurado: ${{ secrets.FTP_REMOTE_DIR }}"
        fi
        
        if [ -z "${{ secrets.FTP_PORT }}" ]; then
          echo "‚ÑπÔ∏è FTP_PORT n√£o configurado (usar√° 21 como padr√£o)"
        else
          echo "‚úÖ FTP_PORT configurado: ${{ secrets.FTP_PORT }}"
        fi
        
        if [ -z "${{ secrets.SITE_URL }}" ]; then
          echo "‚ÑπÔ∏è SITE_URL n√£o configurado (opcional para verifica√ß√£o)"
        else
          echo "‚úÖ SITE_URL configurado: ${{ secrets.SITE_URL }}"
        fi
        
        echo ""
        echo "üìã Status geral:"
        
        # Verificar se os secrets obrigat√≥rios est√£o configurados
        if [ -n "${{ secrets.FTP_SERVER }}" ] && [ -n "${{ secrets.FTP_USERNAME }}" ] && [ -n "${{ secrets.FTP_PASSWORD }}" ]; then
          echo "üéâ Todos os secrets obrigat√≥rios est√£o configurados!"
          echo "‚úÖ Deploy autom√°tico est√° pronto para funcionar"
        else
          echo "‚ö†Ô∏è Secrets obrigat√≥rios n√£o configurados"
          echo ""
          echo "üìù Para configurar os secrets:"
          echo "1. Acesse: https://github.com/${{ github.repository }}/settings/secrets/actions"
          echo "2. Clique em 'New repository secret'"
          echo "3. Adicione os seguintes secrets:"
          echo "   - FTP_SERVER (obrigat√≥rio)"
          echo "   - FTP_USERNAME (obrigat√≥rio)"
          echo "   - FTP_PASSWORD (obrigat√≥rio)"
          echo "   - FTP_REMOTE_DIR (opcional, padr√£o: /)"
          echo "   - FTP_PORT (opcional, padr√£o: 21)"
          echo "   - SITE_URL (opcional, para verifica√ß√£o)"
        fi

    - name: Test FTP Connection (if configured)
      if: ${{ secrets.FTP_SERVER != '' && secrets.FTP_USERNAME != '' && secrets.FTP_PASSWORD != '' }}
      run: |
        echo "üîå Testando conex√£o FTP..."
        
        # Instalar cliente FTP
        sudo apt-get update
        sudo apt-get install -y lftp
        
        # Testar conex√£o
        echo "Tentando conectar em: ${{ secrets.FTP_SERVER }}"
        
        lftp -c "
        set ftp:ssl-allow no;
        set ftp:passive-mode on;
        set net:timeout 10;
        open -u ${{ secrets.FTP_USERNAME }},${{ secrets.FTP_PASSWORD }} ${{ secrets.FTP_SERVER }};
        pwd;
        quit
        " && echo "‚úÖ Conex√£o FTP bem-sucedida!" || echo "‚ùå Falha na conex√£o FTP"